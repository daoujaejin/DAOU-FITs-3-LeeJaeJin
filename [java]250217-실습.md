# BookDetailServlet.java
```
package org.example.bs_servlet_jaejin.controller;

import org.example.bs_servlet_jaejin.dao.BookDAO;
import org.example.bs_servlet_jaejin.mybatis.MyBatisSessionFactory;
import org.example.bs_servlet_jaejin.vo.BookVO;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.io.PrintWriter;

@WebServlet(value = "/bookDetail")
public class BookDetailServlet extends HttpServlet {

    private final BookDAO bookDAO = new BookDAO(MyBatisSessionFactory.getSqlSessionFactory());

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        req.setCharacterEncoding("utf-8");

        // 클라이언트에서 전달된 ISBN 파라미터 받기
        String isbn = req.getParameter("isbn");

        // DAO를 통해 특정 책 정보 가져오기
        BookVO book = bookDAO.getBookByISBN(isbn);

        // 응답 데이터 설정
        resp.setContentType("text/html;charset=utf-8");
        PrintWriter out = resp.getWriter();

        // HTML 시작
        out.println("<!DOCTYPE html>");
        out.println("<html lang='ko'>");
        out.println("<head>");
        out.println("<meta charset='UTF-8'>");
        out.println("<meta name='viewport' content='width=device-width, initial-scale=1.0'>");
        out.println("<title>책 상세 정보</title>");
        out.println("</head>");
        out.println("<body>");

        if (book != null) {
            // 책 정보 출력
            out.println("<h1>책 상세 정보</h1>");
            out.println("<p><strong>ISBN:</strong> " + book.getBisbn() + "</p>");
            out.println("<p><strong>제목:</strong> " + book.getBtitle() + "</p>");
            out.println("<p><strong>가격:</strong> " + book.getBprice() + "원</p>");
            out.println("<p><strong>저자:</strong> " + book.getBauthor() + "</p>");
        } else {
            // 책 정보가 없을 경우 메시지 출력
            out.println("<h1>책 정보를 찾을 수 없습니다.</h1>");
        }

        // HTML 끝
        out.println("</body>");
        out.println("</html>");

        out.flush();
    }
}
```
# BookSearchServlet
```
package org.example.bs_servlet_jaejin.controller;

import org.apache.ibatis.session.SqlSessionFactory;
import org.example.bs_servlet_jaejin.dao.BookDAO;
import org.example.bs_servlet_jaejin.mybatis.MyBatisSessionFactory;
import org.example.bs_servlet_jaejin.vo.BookVO;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.io.PrintWriter;
import java.util.List;

@WebServlet(value = "/bookSearch")
public class BookSearchServlet extends HttpServlet {

    SqlSessionFactory factory = MyBatisSessionFactory.getSqlSessionFactory();
    private final BookDAO bookDAO = new BookDAO(factory);

    public void BookSearch() {
        System.out.println("생성자 호출");
    }

    @Override
    public void init() throws ServletException {
        super.init();
        System.out.println("init 호출");
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        req.setCharacterEncoding("utf-8");
        String bookName = req.getParameter("title");
        String price = req.getParameter("price");
        System.out.println("책 이름: " + bookName + " 가격: " + price);

        List<BookVO> bookList = bookDAO.getBooks(bookName, price);
        req.setAttribute("bookList", bookList);
//        System.out.println("bookList: " + bookList);

//        // 1. 데이터 전달 통로를 열어서 결과데이터를 전달해야 한다.
//        //    전달되는 데이터의 형태를 먼저 지정해야 한다.
        resp.setContentType("text/html;charset=utf-8");
//        // 2. 결과를 돌려주기 위한 데이터 통로를 하나 열어야 한다. (PrintWriter)
        PrintWriter out = resp.getWriter();
//        // 3. 이렇게 열린 통로로 데이터를 전송한다.
        out.println("<html>");
        out.println("<head></head>");
        out.println("<body>");
//        for (BookVO book : bookList) {
//            out.println(book.getBtitle() + ", " + book.getBprice() + "<br>");
//        }
        out.println("<h1>검색 결과</h1>");

        // 테이블 생성
        out.println("<table border='1'>");
        out.println("<thead><tr><th>ISBN</th><th>제목</th><th>가격</th><th>저자</th></tr></thead>");
        out.println("<tbody>");

        for (BookVO book : bookList) {
            // 각 행에 클릭 이벤트 추가 (ISBN을 기반으로 요청)
            out.println("<tr onclick=\"location.href='/BS_Servlet_jaejin_war_exploded/bookDetail?isbn=" + book.getBisbn() + "'\">");
            out.println("<td>" + book.getBisbn() + "</td>");
            out.println("<td>" + book.getBtitle() + "</td>");
            out.println("<td>" + book.getBprice() + "</td>");
            out.println("<td>" + book.getBauthor() + "</td>");
            out.println("</tr>");
        }

        out.println("</tbody>");
        out.println("</table>");

        out.println("</body>");
        out.println("</html>");
        out.flush();
        out.close();
    }

    @Override
    public void destroy() {
        super.destroy();
    }
}
```
# BookDAO.java
```
package org.example.bs_servlet_jaejin.dao;

import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.example.bs_servlet_jaejin.vo.BookVO;

import java.awt.print.Book;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Objects;

public class BookDAO {
    private SqlSessionFactory sqlSessionFactory;

    public BookDAO(SqlSessionFactory sqlSessionFactory) {
        this.sqlSessionFactory = sqlSessionFactory;
    }

    public List<BookVO> getBooks(String title, String price) {
        List<BookVO> list = null;
        try (SqlSession session = sqlSessionFactory.openSession()) {
            Map<String, Object> params = new HashMap<>();
            params.put("title", title);
            if (Objects.equals(price, "1")) {
                params.put("maxPrice", 10000);
            } else if (Objects.equals(price, "2")) {
                params.put("maxPrice", 20000);
            } else if (Objects.equals(price, "3")) {
                params.put("maxPrice", 30000);
            } else if (Objects.equals(price, "4")) {
                params.put("maxPrice", 40000);
            }
            list = session.selectList("BS_Servlet.MyBook.selectBooksByNamePrice",
                    params);
            System.out.println(title);
            System.out.println(price);
        } catch(Exception e) {
            e.printStackTrace();
        }
        return list;
    }

    public BookVO getBookByISBN(String isbn) {
        try (SqlSession session = sqlSessionFactory.openSession()) {
            return session.selectOne("BS_Servlet.MyBook.selectByISBN", isbn);
        }
    }

}
```
# MyBatisSessionFactory.java
```
package org.example.bs_servlet_jaejin.mybatis;

import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;

import java.io.Reader;

public class MyBatisSessionFactory {
    private static SqlSessionFactory sqlSessionFactory;

    static {
        try {
            String resource = "SqlMapConfig.xml";
            Reader reader = Resources.getResourceAsReader(resource);

            if (sqlSessionFactory == null) {
                sqlSessionFactory = new SqlSessionFactoryBuilder().build(reader);
            }
        } catch(Exception e) {
            e.printStackTrace();
        }
    }

    public static SqlSessionFactory getSqlSessionFactory() {
        return sqlSessionFactory;
    }
}
```
# BookVO.java
```
package org.example.bs_servlet_jaejin.vo;

public class BookVO {
    private String bisbn;
    private String btitle;
    private int bprice;
    private String bauthor;
    public BookVO() {
    }

    public BookVO(String bisbn, String btitle, int bprice, String bauthor) {
        this.bisbn = bisbn;
        this.btitle = btitle;
        this.bprice = bprice;
        this.bauthor = bauthor;
    }

    public String getBisbn() {
        return bisbn;
    }

    public void setBisbn(String bisbn) {
        this.bisbn = bisbn;
    }

    public String getBtitle() {
        return btitle;
    }

    public void setBtitle(String btitle) {
        this.btitle = btitle;
    }

    public int getBprice() {
        return bprice;
    }

    public void setBprice(int bprice) {
        this.bprice = bprice;
    }

    public String getBauthor() {
        return bauthor;
    }

    public void setBauthor(String bauthor) {
        this.bauthor = bauthor;
    }
}
```
# Book.xml
```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
        "-//mybatis.org/DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="BS_Servlet.MyBook">
    <select id="selectBooksByNamePrice" parameterType="map"
            resultType="org.example.bs_servlet_jaejin.vo.BookVO">
        <![CDATA[
            SELECT bisbn, btitle, bprice, bauthor
            FROM book
            WHERE btitle LIKE '%' || #{title} || '%'
                AND bprice < #{maxPrice}
        ]]>
    </select>

    <select id="selectByISBN" parameterType="String" resultType="org.example.bs_servlet_jaejin.vo.BookVO">
        <![CDATA[
        SELECT bisbn, btitle, bprice, bauthor
        FROM book
        WHERE bisbn = #{isbn}
        ]]>
    </select>
</mapper>
```
# SqlMapConfig.xml
```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE configuration
        PUBLIC "-//mybatis.org/DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
    <!-- JDBC Driver 클래스와 데이터베이스 연결 설정 -->
    <!-- 이 연결 설정에 대한 내용은 XML 안에 직접 작성하지 않는다.
         별도의 외부파일에 작성해서 해당 파일을 property로
         가져와서 사용한다.
    -->
    <properties resource="./driver.properties"/>

    <!-- MyBatis 실행 설정을 한다. -->
    <!-- 상당히 많은 설정이 있지만, 대부분 default 설정을 이용 -->
    <settings>
        <setting name="jdbcTypeForNull" value="NULL"/>
    </settings>

    <!-- TypeAlias가 나올 수 있다. -->
    <!-- 일반적으로 VO에 대한 alias가 설정된다. -->
    <typeAliases>
        <typeAlias alias="Book" type="org.example.bs_servlet_jaejin.vo.BookVO" />
    </typeAliases>

    <!-- DB 연결 정보 -->
    <environments default="development">
        <environment id="development">
            <!-- transactionManager를 JDBC로 설정하면
                 수동으로 transaction을 설정한다는 의미.
                 commit(), rollback()을 코드에서 제어 => JDBC
                 만약 type이 MANAGE로 설정하면 자동으로 transaction을
                 제어하게 할 수 있다.
            -->
            <transactionManager type="JDBC" />
            <!-- connetcion pool을 사용할지 여부를 설정 -->
            <dataSource type="POOLED" >
                <property name="driver" value="${db.driver}"/>
                <property name="url" value="${db.url}"/>
                <property name="username" value="${db.username}"/>
                <property name="password" value="${db.password}"/>
            </dataSource>
        </environment>
    </environments>

    <!-- SQL구문을 작성하는 mapper라는 xml 파일의 경로를 지정 -->
    <mappers>
        <mapper resource="./sqlmap/Book.xml"/>
    </mappers>

</configuration>
```
# search.html
```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>책 검색</title>
</head>
<body>
    <h1>도서검색 프로그램</h1>
    <form action="http://localhost:8080/BS_Servlet_jaejin_war_exploded/bookSearch"
          method="POST">
        도서명 키워드 : <input name="title" type="text" /><br><br>
        <input type="radio" name="price" value="1">10,000원미만<br>
        <input type="radio" name="price" value="2">20,000원미만<br>
        <input type="radio" name="price" value="3">30,000원미만<br>
        <input type="radio" name="price" value="4">40,000원미만<br>
        <br><br>
        <input type="submit" value="도서 검색!">
    </form>
</body>
</html>
```
