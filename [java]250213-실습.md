# main.java.example
### 213practice.fxml
```
<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.FlowPane?>
<?import javafx.scene.text.Font?>


<BorderPane fx:controller="example.controller.MainController" maxHeight="-Infinity" maxWidth="-Infinity" minHeight="-Infinity" minWidth="-Infinity" prefHeight="400.0" prefWidth="600.0" xmlns="http://javafx.com/javafx/23.0.1" xmlns:fx="http://javafx.com/fxml/1">
   <bottom>
      <BorderPane prefHeight="128.0" prefWidth="600.0" BorderPane.alignment="CENTER">
         <center>
            <FlowPane prefHeight="200.0" prefWidth="200.0" BorderPane.alignment="CENTER">
               <children>
                  <Label text="ISBN">
                     <FlowPane.margin>
                        <Insets left="10.0" top="20.0" />
                     </FlowPane.margin>
                     <font>
                        <Font size="18.0" />
                     </font>
                  </Label>
                  <TextField fx:id="isbnTextField" prefHeight="22.0" prefWidth="65.0">
                     <FlowPane.margin>
                        <Insets left="10.0" top="20.0" />
                     </FlowPane.margin>
                  </TextField>
                  <Label text="제목">
                     <FlowPane.margin>
                        <Insets left="10.0" top="20.0" />
                     </FlowPane.margin>
                     <font>
                        <Font size="18.0" />
                     </font>
                  </Label>
                  <TextField fx:id="titleTextField" prefHeight="22.0" prefWidth="66.0">
                     <FlowPane.margin>
                        <Insets left="10.0" top="20.0" />
                     </FlowPane.margin>
                  </TextField>
                  <Label text="가격">
                     <font>
                        <Font size="18.0" />
                     </font>
                     <FlowPane.margin>
                        <Insets left="10.0" top="20.0" />
                     </FlowPane.margin>
                  </Label>
                  <TextField fx:id="priceTextField" prefHeight="22.0" prefWidth="64.0">
                     <FlowPane.margin>
                        <Insets left="10.0" top="20.0" />
                     </FlowPane.margin>
                  </TextField>
                  <Label text="저자">
                     <font>
                        <Font size="18.0" />
                     </font>
                     <FlowPane.margin>
                        <Insets left="10.0" top="20.0" />
                     </FlowPane.margin>
                  </Label>
                  <TextField fx:id="authorTextField" prefHeight="22.0" prefWidth="75.0">
                     <FlowPane.margin>
                        <Insets left="10.0" top="20.0" />
                     </FlowPane.margin>
                  </TextField>
                  <Button fx:id="registrationBtn" mnemonicParsing="false" text="등록">
                     <FlowPane.margin>
                        <Insets left="10.0" top="20.0" />
                     </FlowPane.margin>
                  </Button>
               </children>
            </FlowPane>
         </center>
         <bottom>
            <FlowPane prefHeight="67.0" prefWidth="600.0" BorderPane.alignment="CENTER">
               <children>
                  <Label text="검색어">
                     <FlowPane.margin>
                        <Insets left="50.0" top="20.0" />
                     </FlowPane.margin>
                     <font>
                        <Font size="24.0" />
                     </font>
                  </Label>
                  <TextField fx:id="searchTextField">
                     <FlowPane.margin>
                        <Insets left="30.0" top="20.0" />
                     </FlowPane.margin>
                  </TextField>
                  <Button fx:id="searchBtn" mnemonicParsing="false" text="검색">
                     <FlowPane.margin>
                        <Insets left="30.0" top="20.0" />
                     </FlowPane.margin>
                     <font>
                        <Font size="18.0" />
                     </font>
                  </Button>
                  <Button fx:id="deleteBtn" mnemonicParsing="false" text="삭제">
                     <font>
                        <Font size="18.0" />
                     </font>
                     <FlowPane.margin>
                        <Insets left="30.0" top="20.0" />
                     </FlowPane.margin>
                  </Button>
               </children>
            </FlowPane>
         </bottom>
      </BorderPane>
   </bottom>
   <center>
      <TableView fx:id="tableView" prefHeight="200.0" prefWidth="200.0" BorderPane.alignment="CENTER">
        <columns>
          <TableColumn fx:id="isbnCol" prefWidth="150.0" text="ISBN" />
          <TableColumn fx:id="titleCol" prefWidth="258.5" text="제목" />
            <TableColumn fx:id="priceCol" prefWidth="103.0" text="가격" />
            <TableColumn fx:id="authorCol" prefWidth="87.5" text="저자" />
        </columns>
      </TableView>
   </center>
</BorderPane>
```
### Main.java
```
package example;

import example.dao.BookDAO;
import example.mybatis.MyBatisSessionFactory;
import javafx.application.Application;
import javafx.fxml.FXMLLoader;
import javafx.scene.Parent;
import javafx.scene.Scene;
import javafx.stage.Stage;
import org.apache.ibatis.session.SqlSessionFactory;

public class Main extends Application {
    @Override
    public void start(Stage stage) throws Exception {
//        SqlSessionFactory factory =
//                MyBatisSessionFactory.getSqlSessionFactory();
//        BookDAO dao = new BookDAO(factory);

        Parent root = null;
        FXMLLoader loader = new FXMLLoader(getClass().getResource("213practice.fxml"));
        try {
            root = loader.load();
        } catch(Exception e) {
            e.printStackTrace();
        }
        Scene scene = new Scene(root);
        stage.setScene(scene);
        stage.setTitle("도서검색 MVC");

        stage.show();
    }

    public static void main(String[] args) {
        launch(args);

        // DAO가 있어야지 데이터베이스 처리를 할 수 있다.
        // DAO를 만들려면 SqlSessionFactory가 있어야 한다.
//        SqlSessionFactory factory =
//                MyBatisSessionFactory.getSqlSessionFactory();
//        BookDAO dao = new BookDAO(factory);

//        HashMap<String, Object> map =
//                dao.selectByISBNHashMap("89-7914-063-0");
//        // 책 1권에 대한 정보가 hashmap에 저장된다.
//        // key값으로는 컬럼명이, value는 컬럼의 값이 저장되어 리턴된다.
//        for (Object key : map.keySet()) {
//            System.out.println(key + "=" + map.get(key));
//        }

//        List<HashMap<String, Object>> list = dao.selectAllHashMap();
//        for (HashMap<String, Object> h : list) {
//            for (String key : h.keySet()) {
//                System.out.println(key + " : " + h.get(key));
//            }
//            System.out.println();
//        }

        // bisbn을 이용해서 책 1권을 가져오는데 BookVO에 데이터를
        // 담아서 가져온다.
//        BookVO vo = dao.selectByISBNBook("89-7914-063-0");
    }
}
```
# resource
### driver.properties
```
db.driver=oracle.jdbc.driver.OracleDriver
db.url=jdbc:oracle:thin:@localhost:1521:xe
db.username=C##2
db.password=1234
```
### SqlMapConfig.xml
```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE configuration
        PUBLIC "-//mybatis.org/DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
    <!-- JDBC Driver 클래스와 데이터베이스 연결 설정 -->
    <!-- 이 연결 설정에 대한 내용은 XML 안에 직접 작성하지 않는다.
         별도의 외부파일에 작성해서 해당 파일을 property로
         가져와서 사용한다.
    -->
    <properties resource="./driver.properties"/>

    <!-- MyBatis 실행 설정을 한다. -->
    <!-- 상당히 많은 설정이 있지만, 대부분 default 설정을 이용 -->
    <settings>
        <setting name="jdbcTypeForNull" value="NULL"/>
    </settings>

    <!-- TypeAlias가 나올 수 있다. -->
    <!-- 일반적으로 VO에 대한 alias가 설정된다. -->
    <typeAliases>
        <typeAlias alias="Book" type="example.vo.BookVO" />
    </typeAliases>

    <!-- DB 연결 정보 -->
    <environments default="development">
        <environment id="development">
            <!-- transactionManager를 JDBC로 설정하면
                 수동으로 transaction을 설정한다는 의미.
                 commit(), rollback()을 코드에서 제어 => JDBC
                 만약 type이 MANAGE로 설정하면 자동으로 transaction을
                 제어하게 할 수 있다.
            -->
            <transactionManager type="JDBC" />
            <!-- connetcion pool을 사용할지 여부를 설정 -->
            <dataSource type="POOLED" >
                <property name="driver" value="${db.driver}"/>
                <property name="url" value="${db.url}"/>
                <property name="username" value="${db.username}"/>
                <property name="password" value="${db.password}"/>
            </dataSource>
        </environment>
    </environments>

    <!-- SQL구문을 작성하는 mapper라는 xml 파일의 경로를 지정 -->
    <mappers>
        <mapper resource="./sqlmap/Book.xml"/>
    </mappers>

</configuration>
```
## sqlmap
### Book.xml
```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
        "-//mybatis.org/DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="example.MyBook">
    <select id="selectByISBNHashMap" parameterType="String"
        resultType="HashMap">
        <![CDATA[
            SELECT bisbn, btitle, bprice, bauthor
            FROM book
            WHERE bisbn = #{bisbn}
        ]]>
    </select>

    <select id="selectAllHashMap"
            resultType="HashMap">
        <![CDATA[
        SELECT bisbn, btitle, bprice, bauthor
        FROM book
        ]]>
    </select>

    <select id="selectAllBookVO" parameterType="String"
            resultType="Book">
        <![CDATA[
        SELECT bisbn, btitle, bprice, bauthor
        FROM book
        WHERE bisbn = #{s}
        ]]>
    </select>

    <insert id="insertBook" parameterType="example.vo.BookVO">
        <![CDATA[
        INSERT INTO book (bisbn, btitle, bprice, bauthor)
        VALUES (#{bisbn}, #{btitle}, #{bprice}, #{bauthor})
        ]]>
    </insert>

    <select id="searchBooksByTitle" parameterType="String" resultType="example.vo.BookVO">
     <![CDATA[
        SELECT bisbn, btitle, bprice, bauthor FROM book WHERE btitle LIKE '%' || #{title} || '%'
        ]]>
    </select>

    <delete id="deleteBookByISBN" parameterType="String">
    <![CDATA[
        DELETE FROM book WHERE bisbn = #{isbn}
        ]]>
    </delete>

</mapper>
```
## controller
### MainController.java
```
package example.controller;

import example.dao.BookDAO;
import example.mybatis.MyBatisSessionFactory;
import example.vo.BookVO;
import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.fxml.FXML;
import javafx.fxml.Initializable;
import javafx.scene.control.*;
import javafx.scene.control.cell.PropertyValueFactory;
import org.apache.ibatis.session.SqlSessionFactory;

import java.util.*;
import java.net.URL;
import java.util.ResourceBundle;

public class MainController implements Initializable {
    @FXML private TextField isbnTextField;
    @FXML private TextField titleTextField;
    @FXML private TextField priceTextField;
    @FXML private TextField authorTextField;
    @FXML private Button registrationBtn;
    @FXML private Button searchBtn;
    @FXML private Button deleteBtn;
    @FXML private TextField searchTextField;

    @FXML private TableView<BookVO> tableView;
    @FXML private TableColumn<BookVO, String> isbnCol;
    @FXML private TableColumn<BookVO, String> titleCol;
    @FXML private TableColumn<BookVO, String> authorCol;
    @FXML private TableColumn<BookVO, Integer> priceCol;

    SqlSessionFactory factory =
                    MyBatisSessionFactory.getSqlSessionFactory();
    private final BookDAO bookDAO = new BookDAO(factory);

    private ObservableList<BookVO> bookList = FXCollections.observableArrayList();

    @Override
    public void initialize(URL url, ResourceBundle resourceBundle) {
        isbnCol.setCellValueFactory(new PropertyValueFactory<>("bisbn"));
        titleCol.setCellValueFactory(new PropertyValueFactory<>("btitle"));
        authorCol.setCellValueFactory(new PropertyValueFactory<>("bauthor"));
        priceCol.setCellValueFactory(new PropertyValueFactory<>("bprice"));

        tableView.setItems(bookList);

        // 버튼 이벤트 설정
        registrationBtn.setOnAction(event -> registerBook());
        searchBtn.setOnAction(event -> searchBooks());
        deleteBtn.setOnAction(event -> deleteSelectedBook());
    }

    // 책 등록 메서드
    private void registerBook() {
        try {
            String isbn = isbnTextField.getText();
            String title = titleTextField.getText();
            int price = Integer.parseInt(priceTextField.getText());
            String author = authorTextField.getText();

            if (isbn.isEmpty() || title.isEmpty() || author.isEmpty()) {
                showAlert(Alert.AlertType.WARNING, "입력 오류", "모든 필드를 채워주세요.");
                return;
            }

            BookVO newBook = new BookVO(isbn, title, price, author);
            bookDAO.insertBook(newBook); // DAO를 통해 데이터베이스에 삽입

            bookList.add(newBook); // TableView에 추가
//            clearInputFields(); // 입력 필드 초기화
            showAlert(Alert.AlertType.INFORMATION, "등록 성공", "책이 성공적으로 등록되었습니다.");
        } catch (NumberFormatException e) {
            showAlert(Alert.AlertType.ERROR, "입력 오류", "가격은 숫자로 입력해야 합니다.");
        }
    }

    // 책 검색 메서드
    private void searchBooks() {
        String searchTitle = searchTextField.getText();
        if (searchTitle.isEmpty()) {
            showAlert(Alert.AlertType.WARNING, "검색 오류", "검색어를 입력하세요.");
            return;
        }

        List<BookVO> result = bookDAO.searchBooksByTitle(searchTitle); // DAO를 통해 검색
        bookList.setAll(result); // 검색 결과를 TableView에 표시
    }

    // 선택된 책 삭제 메서드
    private void deleteSelectedBook() {
        BookVO selectedBook = tableView.getSelectionModel().getSelectedItem();
        if (selectedBook == null) {
            showAlert(Alert.AlertType.WARNING, "삭제 오류", "삭제할 책을 선택하세요.");
            return;
        }

        bookDAO.deleteBookByISBN(selectedBook.getBisbn()); // DAO를 통해 데이터베이스에서 삭제
        bookList.remove(selectedBook); // TableView에서 제거
        showAlert(Alert.AlertType.INFORMATION, "삭제 성공", "선택된 책이 삭제되었습니다.");
    }

    // 알림창 표시 메서드
    private void showAlert(Alert.AlertType alertType, String title, String message) {
        Alert alert = new Alert(alertType);
        alert.setTitle(title);
        alert.setContentText(message);
        alert.showAndWait();
    }
}
```
## dao
### BookDAO.java
```
package example.dao;

import example.vo.BookVO;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;

import java.util.HashMap;
import java.util.List;

// 어제는 DAO에게 connection이 전달되었다.
// 이번에는 SQLSessionFactory를 DAO에게 전달한다.
public class BookDAO {

    private SqlSessionFactory sqlSessionFactory;

    public BookDAO(SqlSessionFactory sqlSessionFactory) {
        this.sqlSessionFactory = sqlSessionFactory;
    }

    // 1. bisbn을 이용해서 책 1권의 정보를 HashMap으로 가져온다.
//    public HashMap<String, Object> selectByISBNHashMap(String bisbn) {
//        HashMap<String, Object> map = null;
//        SqlSession sqlSession = sqlSessionFactory.openSession();
//        // 이 SqlSession 객체에 transaction이 설정된다.
//        try{
//            map = sqlSession.selectOne("example.MyBook.selectByISBNHashMap",
//                    bisbn);
//        } catch(Exception e) {
//            e.printStackTrace();
//        } finally {
//            sqlSession.close();
//        }
//        return map;
//    }

    // 2. 각 책들의 정보를 hashMap에 담아서 전체 책을 list에 담아서 가져온다.
    public List<HashMap<String, Object>> selectAllHashMap() {
        List<HashMap<String, Object>> list = null;

        SqlSession sqlSession = sqlSessionFactory.openSession();
        // 이 SqlSession 객체에 transaction이 설정된다.
        try{
            list = sqlSession.selectList("example.MyBook.selectAllHashMap");
        } catch(Exception e) {
            e.printStackTrace();
        } finally {
            sqlSession.close();
        }
        return list;
    }

    public BookVO selectByISBNBook(String s) {
        BookVO bookVO = null;
        SqlSession sqlSession = sqlSessionFactory.openSession();

        try{
            bookVO = sqlSession.selectOne("example.MyBook.selectAllBookVO", s);
        } catch(Exception e) {
            e.printStackTrace();
        } finally {
            sqlSession.close();
        }
        return bookVO;
    }

    public void insertBook(BookVO book) {
        try (SqlSession session = sqlSessionFactory.openSession()) {
            session.insert("example.MyBook.insertBook", book);
            session.commit();
        }
    }

    public void deleteBookByISBN(String isbn) {
        try (SqlSession session = sqlSessionFactory.openSession()) {
            session.delete("example.MyBook.deleteBookByISBN", isbn);
            session.commit();
        }
    }

    public List<BookVO> searchBooksByTitle(String title) {
        List<BookVO> list = null;
        try (SqlSession session = sqlSessionFactory.openSession()) {
            list = session.selectList("example.MyBook.searchBooksByTitle", title);
        }
        return list;
    }
}
```
## mybatis
### MyBatisSessionFactory
```
package example.mybatis;

import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;

import java.io.Reader;

// 결국 이 Java class가 하는 일은
// SqlSessionFactory이라는 객체가 우리 DAO에서 필요하기 때문에
// 이 객체를 통해서 우리는 SqlSession 객체를 뽑아낼 수 있다.
// 그리고 이 SqlSession 객체를 이용해야지만 우리가 SQL문을 실행할 수 있다.

public class MyBatisSessionFactory {
    private static SqlSessionFactory sqlSessionFactory;

    static {
        try {
            String resource = "./SqlMapConfig.xml";
            Reader reader = Resources.getResourceAsReader(resource);

            if (sqlSessionFactory == null) {
                sqlSessionFactory =
                        new SqlSessionFactoryBuilder().build(reader);
            }
        } catch(Exception e) {
            e.printStackTrace();
        }
    }

    public static SqlSessionFactory getSqlSessionFactory() {
        return sqlSessionFactory;
    }
}
```
## vo
### BookVO
```
package example.vo;

public class BookVO {
    private String bisbn;
    private String btitle;
    private int bprice;
    private String bauthor;

    public BookVO() {
    }

    public BookVO(String bisbn, String btitle, int bprice, String bauthor) {
        this.bisbn = bisbn;
        this.btitle = btitle;
        this.bprice = bprice;
        this.bauthor = bauthor;
    }

    public String getBisbn() {
        return bisbn;
    }

    public void setBisbn(String bisbn) {
        this.bisbn = bisbn;
    }

    public String getBtitle() {
        return btitle;
    }

    public void setBtitle(String btitle) {
        this.btitle = btitle;
    }

    public int getBprice() {
        return bprice;
    }

    public void setBprice(int bprice) {
        this.bprice = bprice;
    }

    public String getBauthor() {
        return bauthor;
    }

    public void setBauthor(String bauthor) {
        this.bauthor = bauthor;
    }
}
```
