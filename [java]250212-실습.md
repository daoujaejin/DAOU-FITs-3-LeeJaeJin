# BookController.java
```
package BookReview.controller;

import BookReview.service.BookService;
import BookReview.service.BookServiceImpl;
import BookReview.vo.BookVO;
import booksearch.vo.Book;
import javafx.collections.ObservableList;
import javafx.fxml.FXML;
import javafx.fxml.Initializable;
import javafx.scene.control.*;
import javafx.scene.control.cell.PropertyValueFactory;
import javafx.scene.layout.GridPane;

import java.net.URL;
import java.util.Optional;
import java.util.ResourceBundle;

public class BookController implements Initializable {
    private final BookService bookService;

    // 생성자를 통해 의존성 주입
    public BookController() {
        this.bookService = new BookServiceImpl();
    }

    @FXML private TableView<BookVO> tableView;
    @FXML private TableColumn<BookVO, String> isbnCol;
    @FXML private TableColumn<BookVO, String> titleCol;
    @FXML private TableColumn<BookVO, Integer> priceCol;
    @FXML private TableColumn<BookVO, String> authorCol;
    @FXML private TextField searchField;
    @FXML private Button searchBtn, insertBtn;



    @Override
    public void initialize(URL url, ResourceBundle resourceBundle) {
        // 테이블 컬럼과 Book 객체의 속성을 매핑
        isbnCol.setCellValueFactory(new PropertyValueFactory<>("bisbn"));
        titleCol.setCellValueFactory(new PropertyValueFactory<>("btitle"));
        priceCol.setCellValueFactory(new PropertyValueFactory<>("bprice"));
        authorCol.setCellValueFactory(new PropertyValueFactory<>("bauthor"));

        searchBtn.setOnAction(event -> loadBooks());
        insertBtn.setOnAction(event -> handleInsert());

        // 테이블에서 더블클릭 시 수정 기능 호출
        tableView.setOnMouseClicked(event -> {
            if (event.getClickCount() == 2) {  // 더블클릭
                handleEditButtonAction();
            }
        });

        loadBooks();
    }

    private void loadBooks() {
        ObservableList<BookVO> books = bookService.searchBooks(searchField.getText());
        tableView.setItems(books);
    }

    @FXML
    private void handleInsert() {
        Dialog<BookVO> dialog = new Dialog<>();
        dialog.setTitle("새 책 추가");
        dialog.setHeaderText("새 책 정보를 입력하세요.");
        dialog.getDialogPane().getButtonTypes().addAll(ButtonType.OK, ButtonType.CANCEL);

        GridPane grid = new GridPane();
        TextField isbnField = new TextField();
        TextField titleField = new TextField();
        TextField priceField = new TextField();
        TextField authorField = new TextField();
        grid.add(new Label("ISBN:"), 0, 0); grid.add(isbnField, 1, 0);
        grid.add(new Label("책 제목:"), 0, 1); grid.add(titleField, 1, 1);
        grid.add(new Label("가격:"), 0, 2); grid.add(priceField, 1, 2);
        grid.add(new Label("저자:"), 0, 3); grid.add(authorField, 1, 3);
        dialog.getDialogPane().setContent(grid);

        dialog.setResultConverter(button -> {
            if (button == ButtonType.OK) {
                try {
                    return new BookVO(
                            isbnField.getText(),
                            titleField.getText(),
                            Integer.parseInt(priceField.getText()),
                            authorField.getText()
                    );
                } catch (NumberFormatException e) {
                    showAlert("입력 오류", "가격은 숫자로 입력해야 합니다.");
                }
            }
            return null;
        });

        Optional<BookVO> result = dialog.showAndWait();
        result.ifPresent(book -> {
            bookService.addBook(book);
            loadBooks();
        });
    }

    // 수정 버튼 클릭 시 책 수정 다이얼로그 열기
    @FXML
    private void handleEditButtonAction() {
        BookVO selectedBook = tableView.getSelectionModel().getSelectedItem();
        if (selectedBook != null) {
            // 책 정보를 수정하는 다이얼로그 생성
            Dialog<BookVO> dialog = new Dialog<>();
            dialog.setTitle("책 정보 수정");
            dialog.setHeaderText("책 정보를 수정하세요.");

            // 다이얼로그 버튼 설정
            dialog.getDialogPane().getButtonTypes().addAll(ButtonType.OK, ButtonType.CANCEL);

            // 다이얼로그 내용 설정
            GridPane grid = new GridPane();
            grid.setHgap(10);
            grid.setVgap(10);

            TextField isbnField = new TextField(selectedBook.getBisbn());
            TextField titleField = new TextField(selectedBook.getBtitle());
            TextField priceField = new TextField(String.valueOf(selectedBook.getBprice()));
            TextField authorField = new TextField(selectedBook.getBauthor());

            grid.add(new Label("ISBN:"), 0, 0);
            grid.add(isbnField, 1, 0);
            grid.add(new Label("책 제목:"), 0, 1);
            grid.add(titleField, 1, 1);
            grid.add(new Label("책 가격:"), 0, 2);
            grid.add(priceField, 1, 2);
            grid.add(new Label("책 저자:"), 0, 3);
            grid.add(authorField, 1, 3);

            dialog.getDialogPane().setContent(grid);

            // 다이얼로그 결과 처리
            dialog.setResultConverter(buttonType -> {
                if (buttonType == ButtonType.OK) {
                    return new BookVO(
                            isbnField.getText(),
                            titleField.getText(),
                            Integer.parseInt(priceField.getText()),
                            authorField.getText()
                    );
                }
                return null;
            });

            Optional<BookVO> result = dialog.showAndWait();
            result.ifPresent(updatedBook -> {
                bookService.modifyBook(updatedBook);
                loadBooks();  // 수정 후 테이블 갱신
            });
        }
    }



    private void showAlert(String title, String message) {
        Alert alert = new Alert(Alert.AlertType.ERROR);
        alert.setTitle(title);
        alert.setHeaderText(null);
        alert.setContentText(message);
        alert.showAndWait();
    }
}
```
# BookDAO.java
```
package BookReview.DAO;

import BookReview.vo.BookVO;
import javafx.collections.FXCollections;
import javafx.collections.ObservableList;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;

public class BookDAO {

    private ConnectionMaker connectionMaker;

    public BookDAO(ConnectionMaker connectionMaker) {
        //직접 객체를 생성하는게 아니라 인젝션받아서 사용(생성자 주입)
        this.connectionMaker = connectionMaker;
    }

    //조회 메서드
    public ObservableList<BookVO> select(String keyword) {
        ObservableList<BookVO> list = FXCollections.observableArrayList();

        try {
            Connection conn = connectionMaker.makeConnection();

            String sql = "select bisbn, btitle, bprice, bauthor from book where btitle LIKE ?";
            PreparedStatement ps = conn.prepareStatement(sql);
            ps.setString(1, "%" + keyword + "%");

            ResultSet rs = ps.executeQuery();
            while (rs.next()) {
                BookVO book = new BookVO(rs.getString("bisbn"),
                        rs.getString("btitle"),
                        rs.getInt("bprice"),
                        rs.getString("bauthor"));
                list.add(book);
            }

            rs.close();
            ps.close();

        } catch (Exception e) {
            e.printStackTrace();
        }

        return list;
    }


    //삽입 메서드
    public void insert(BookVO book) {

        try {
            Connection conn = connectionMaker.makeConnection();
            String sql = "INSERT INTO book (bisbn, btitle, bprice, bauthor) VALUES (?, ?, ?, ?)";

            PreparedStatement pstmt = conn.prepareStatement(sql);

            pstmt.setString(1, book.getBisbn());
            pstmt.setString(2, book.getBtitle());
            pstmt.setInt(3, book.getBprice());
            pstmt.setString(4, book.getBauthor());
            pstmt.executeUpdate();
            pstmt.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }



    // 데이터베이스에서 책 삭제
    public void delete(String bisbn) {
        try {
            Connection conn = connectionMaker.makeConnection();
            String sql = "DELETE FROM book WHERE bisbn = ?";
            PreparedStatement pstmt = conn.prepareStatement(sql);

            pstmt.setString(1, bisbn);
            pstmt.executeUpdate();
            pstmt.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    // 데이터베이스에서 책 정보 수정
    public void update(BookVO book) {

        try {
            Connection conn = connectionMaker.makeConnection();
            String sql = "UPDATE book SET btitle = ?, bprice = ?, bauthor = ? WHERE bisbn = ?";
            PreparedStatement pstmt = conn.prepareStatement(sql);

            pstmt.setString(1, book.getBtitle());
            pstmt.setInt(2, book.getBprice());
            pstmt.setString(3, book.getBauthor());
            pstmt.setString(4, book.getBisbn());
            pstmt.executeUpdate();
            pstmt.close();

        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```
# ConnectionMaker.java
```
package BookReview.DAO;

import java.sql.Connection;
import java.sql.SQLException;

public interface ConnectionMaker {

    public Connection makeConnection() throws ClassNotFoundException, SQLException;


}
```
# KConnectionMaker.java
```
package BookReview.DAO;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class KConnectionMaker implements ConnectionMaker {

    @Override
    public Connection makeConnection() throws ClassNotFoundException, SQLException {
        Class.forName("oracle.jdbc.driver.OracleDriver");
        String jdbcUrl = "jdbc:oracle:thin:@localhost:1521/xe";
        Connection con = DriverManager.getConnection(jdbcUrl,"C##DEV","sys1234");
        System.out.println("데이터베이스 연결 성공");
        return con;
    }

}
```
# BookService.java
```
package BookReview.service;

import BookReview.vo.BookVO;
import javafx.collections.ObservableList;

public interface BookService {
    ObservableList<BookVO> searchBooks(String keyword);
    void addBook(BookVO book);
    void removeBook(String bisbn);
    void modifyBook(BookVO book);
}
```
# BookServiceImpl.java
```
package BookReview.service;

import BookReview.DAO.BookDAO;
import BookReview.DAO.ConnectionMaker;
import BookReview.DAO.KConnectionMaker;
import BookReview.vo.BookVO;
import javafx.collections.ObservableList;

public class BookServiceImpl implements BookService {

    private final BookDAO bookDAO;

    // 생성자를 통해 의존성 주입
    public BookServiceImpl() {
        ConnectionMaker connectionMaker = new KConnectionMaker();
        this.bookDAO = new BookDAO(connectionMaker);
    }

    @Override
    public ObservableList<BookVO> searchBooks(String keyword) {
        return bookDAO.select(keyword);
    }

    @Override
    public void addBook(BookVO book) {
        bookDAO.insert(book);
    }

    @Override
    public void removeBook(String bisbn) {
        bookDAO.delete(bisbn);
    }

    @Override
    public void modifyBook(BookVO book) {
        bookDAO.update(book);
    }
}
```
# BookView.java
```
package BookReview.view;

import javafx.application.Application;
import javafx.fxml.FXMLLoader;
import javafx.scene.Parent;
import javafx.scene.Scene;
import javafx.stage.Stage;

public class BookView extends Application {

    @Override
    public void start(Stage stage) throws Exception {
        //화면구성
        Parent root = null;
        FXMLLoader loader = new FXMLLoader(getClass().getResource("table.fxml"));

        try{
            root = loader.load();
        } catch (Exception e){
            e.printStackTrace();
        }
        Scene scene = new Scene(root);
        stage.setScene(scene);
        stage.setTitle("Book Search");
        stage.show();
    }

    public static void main(String[] args) {
        launch(args);
    }
}
```
# table.fxml
```
<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.FlowPane?>
<?import javafx.scene.text.Font?>


<BorderPane fx:controller="BookReview.controller.BookController" maxHeight="-Infinity" maxWidth="-Infinity" minHeight="-Infinity" minWidth="-Infinity" prefHeight="400.0" prefWidth="700.0" xmlns="http://javafx.com/javafx/23.0.1" xmlns:fx="http://javafx.com/fxml/1">
   <center>
      <TableView fx:id="tableView" prefHeight="308.0" prefWidth="700.0" BorderPane.alignment="CENTER">
         <columns>
            <TableColumn fx:id="isbnCol" prefWidth="75.0" text="ISBN" />
            <TableColumn fx:id="titleCol" prefWidth="215.5" text="책 제목" />
            <TableColumn fx:id="priceCol" prefWidth="157.0" text="책 가격" />
            <TableColumn fx:id="authorCol" prefWidth="151.5" text="책 저자" />
         </columns>
      </TableView>
   </center>
   <bottom>
      <FlowPane prefHeight="72.0" prefWidth="600.0" BorderPane.alignment="CENTER">
         <children>
            <Label text="검색어">
               <font>
                  <Font size="24.0" />
               </font>
               <FlowPane.margin>
                  <Insets left="100.0" top="20.0" />
               </FlowPane.margin>
            </Label>
            <TextField fx:id="searchField">
               <FlowPane.margin>
                  <Insets left="30.0" top="20.0" />
               </FlowPane.margin>
            </TextField>
            <Button fx:id="searchBtn" mnemonicParsing="false" text="검색">
               <FlowPane.margin>
                  <Insets left="30.0" top="20.0" />
               </FlowPane.margin>
               <font>
                  <Font size="20.0" />
               </font>
            </Button>
            <Button fx:id="insertBtn" mnemonicParsing="false" text="추가" onAction="#handleInsert">
               <FlowPane.margin>
                  <Insets left="30.0" top="20.0" />
               </FlowPane.margin>
               <font>
                  <Font size="20.0" />
               </font>
            </Button>
         </children>
      </FlowPane>
   </bottom>
</BorderPane>
```
# BookVO.java
```
package BookReview.vo;

public class BookVO {

    private String bisbn;
    private String btitle;
    private int bprice;
    private String bauthor;

    public BookVO() {

    }

    public BookVO(String bisbn, String btitle, int bprice, String bauthor) {
        this.bisbn = bisbn;
        this.btitle = btitle;
        this.bprice = bprice;
        this.bauthor = bauthor;
    }

    public String getBisbn() {
        return bisbn;
    }

    public void setBisbn(String bisbn) {
        this.bisbn = bisbn;
    }

    public String getBtitle() {
        return btitle;
    }

    public void setBtitle(String btitle) {
        this.btitle = btitle;
    }

    public int getBprice() {
        return bprice;
    }

    public void setBprice(int bprice) {
        this.bprice = bprice;
    }

    public String getBauthor() {
        return bauthor;
    }

    public void setBauthor(String bauthor) {
        this.bauthor = bauthor;
    }
}
```
